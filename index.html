<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Declara√ß√£o ISSQN - Profissional Aut√¥nomo</title>
    
    <!-- Bibliotecas para PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 20px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 24px;
            margin-bottom: 10px;
        }

        .header h2 {
            color: #667eea;
            font-size: 18px;
            font-weight: normal;
            margin-bottom: 5px;
        }

        .header p {
            color: #7f8c8d;
            font-size: 14px;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section h3 {
            background: #667eea;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 16px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #2c3e50;
            font-weight: bold;
            font-size: 14px;
        }

        label.required::after {
            content: " *";
            color: #e74c3c;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #dfe6e9;
            border-radius: 5px;
            font-size: 14px;
            transition: all 0.3s;
        }

        input[readonly] {
            background-color: #f5f6fa;
            cursor: not-allowed;
            color: #666;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Aviso sobre o PDF */
        .pdf-warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffe69c 100%);
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 20px;
            margin: 30px 0;
        }

        .pdf-warning h4 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pdf-warning p {
            color: #856404;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .pdf-warning ul {
            margin-left: 20px;
            color: #856404;
            font-size: 13px;
        }

        .pdf-warning ul li {
            margin-bottom: 5px;
        }

        .btn-submit {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            margin-top: 20px;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-overlay.show {
            display: flex;
        }

        .loading-content {
            text-align: center;
            color: white;
        }

        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Estilos para o PDF */
        .pdf-document {
            position: absolute;
            left: -9999px;
            top: 0;
            background: white;
            width: 190mm; /* Reduzido para dar margem */
            padding: 10mm;
            font-family: Arial, sans-serif;
            font-size: 10.5pt;
            line-height: 1.4;
            color: #000;
        }

        .pdf-document .pdf-header {
            text-align: center;
            margin-bottom: 18px;
            border-bottom: 2px solid #333;
            padding-bottom: 12px;
        }

        .pdf-document .pdf-header h1 {
            font-size: 17pt;
            margin-bottom: 6px;
            color: #000;
        }

        .pdf-document .pdf-header h2 {
            font-size: 13pt;
            margin-bottom: 4px;
            font-weight: normal;
            color: #333;
        }

        .pdf-document .pdf-header p {
            font-size: 9pt;
            color: #666;
        }

        .pdf-document h3 {
            background: #333;
            color: white;
            padding: 6px 10px;
            margin: 15px 0 10px 0;
            font-size: 11pt;
            page-break-after: avoid;
        }

        .pdf-document p {
            margin-bottom: 10px;
            text-align: justify;
            page-break-inside: avoid;
        }

        .pdf-document .field-line {
            margin-bottom: 6px;
            line-height: 1.6;
        }

        .pdf-document .checkbox-line {
            margin: 6px 0;
            padding: 4px;
            border: 1px solid #ddd;
            page-break-inside: avoid;
        }

        .pdf-document table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
            page-break-inside: avoid;
        }

        .pdf-document table th,
        .pdf-document table td {
            border: 1px solid #333;
            padding: 6px;
            text-align: left;
            font-size: 9.5pt;
        }

        .pdf-document table th {
            background: #f0f0f0;
            font-weight: bold;
        }

        .pdf-document .signature-area {
            margin-top: 35px;
            text-align: center;
            page-break-inside: avoid;
        }

        .pdf-document .signature-line {
            border-top: 1px solid #000;
            width: 300px;
            margin: 45px auto 8px;
        }

        .pdf-document hr {
            border: none;
            border-top: 1px solid #333;
            margin: 15px 0;
        }

        .pdf-document .page-break {
            page-break-before: always;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>DECLARA√á√ÉO DE EXERC√çCIO DE ATIVIDADE AUT√îNOMA</h1>
            <h2>Para fins de lan√ßamento do ISSQN</h2>
            <p>Prefeitura Municipal de Porto Velho - Secretaria Municipal de Economia (SEMEC)</p>
        </div>

        <form id="declaracaoForm">
            <div class="form-section">
                <h3>üìã Dados Pessoais</h3>
                
                <div class="form-group">
                    <label for="nome" class="required">Nome Completo</label>
                    <input type="text" id="nome" name="nome" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="cpf" class="required">CPF</label>
                        <input type="text" id="cpf" name="cpf" placeholder="000.000.000-00" required>
                    </div>
                    <div class="form-group">
                        <label for="rg" class="required">RG</label>
                        <input type="text" id="rg" name="rg" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="dataNascimento" class="required">Data de Nascimento</label>
                        <input type="date" id="dataNascimento" name="dataNascimento" required>
                    </div>
                    <div class="form-group">
                        <label for="telefone" class="required">Telefone</label>
                        <input type="tel" id="telefone" name="telefone" placeholder="(00) 00000-0000" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="email" class="required">E-mail</label>
                    <input type="email" id="email" name="email" required>
                </div>
            </div>

            <div class="form-section">
                <h3>üìç Endere√ßo</h3>
                
                <div class="form-group">
                    <label for="endereco" class="required">Endere√ßo Completo (Rua, N√∫mero, Complemento)</label>
                    <input type="text" id="endereco" name="endereco" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="bairro" class="required">Bairro</label>
                        <input type="text" id="bairro" name="bairro" required>
                    </div>
                    <div class="form-group">
                        <label for="cep" class="required">CEP</label>
                        <input type="text" id="cep" name="cep" placeholder="00000-000" required>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>üíº Dados Profissionais</h3>
                
                <div class="form-group">
                    <label for="profissao" class="required">Profiss√£o/Atividade Exercida</label>
                    <input type="text" id="profissao" name="profissao" 
                           placeholder="Ex: Eletricista, Pedreiro, Manicure, etc." required>
                </div>

                <div class="form-group">
                    <label for="localPrestacao" class="required">Local de Presta√ß√£o dos Servi√ßos</label>
                    <textarea id="localPrestacao" name="localPrestacao" rows="2" required></textarea>
                </div>

                <div class="form-group">
                    <label for="nivel" class="required">N√≠vel de Escolaridade</label>
                    <select id="nivel" name="nivel" required>
                        <option value="">Selecione...</option>
                        <option value="1">N√≠vel Fundamental ou Nenhuma Escolaridade (1 UPF)</option>
                        <option value="2">N√≠vel M√©dio (1,5 UPF)</option>
                        <option value="3">N√≠vel Superior (2 UPF)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="valorUPF">Valor da UPF (R$) - Valor Fixo</label>
                    <input type="text" id="valorUPF" name="valorUPF" value="139,03" readonly>
                </div>

                <div class="form-group">
                    <label for="dataDeclaracao" class="required">Data da Declara√ß√£o</label>
                    <input type="date" id="dataDeclaracao" name="dataDeclaracao" required>
                </div>
            </div>

            <!-- Aviso sobre o conte√∫do do PDF -->
            <div class="pdf-warning">
                <h4>‚ö†Ô∏è ATEN√á√ÉO - Sobre a Declara√ß√£o</h4>
                <p><strong>Ao gerar o PDF, voc√™ estar√° produzindo um documento oficial que cont√©m:</strong></p>
                <ul>
                    <li><strong>Declara√ß√£o de exerc√≠cio de atividade aut√¥noma</strong> no Munic√≠pio de Porto Velho/RO</li>
                    <li><strong>Enquadramento tribut√°rio</strong> conforme seu n√≠vel de escolaridade</li>
                    <li><strong>Reconhecimento da obriga√ß√£o tribut√°ria</strong> do ISSQN</li>
                    <li><strong>Confiss√£o irrevog√°vel de d√≠vida</strong> para fins de lan√ßamento mensal do imposto</li>
                    <li><strong>Concord√¢ncia com procedimentos de cobran√ßa</strong> (multa, juros, inscri√ß√£o em d√≠vida ativa, protesto e execu√ß√£o fiscal)</li>
                    <li><strong>Declara√ß√£o de responsabilidade</strong> pela veracidade das informa√ß√µes prestadas</li>
                    <li><strong>Compromisso</strong> de comunicar qualquer altera√ß√£o cadastral √† SEMEC</li>
                </ul>
                <p style="margin-top: 10px;"><strong>Este documento tem validade legal e produzir√° efeitos jur√≠dicos!</strong></p>
            </div>

            <button type="submit" class="btn-submit">
                üìÑ Gerar Declara√ß√£o em PDF
            </button>
        </form>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <h2>Gerando PDF...</h2>
            <p>Por favor, aguarde alguns instantes</p>
        </div>
    </div>

    <!-- Container para o PDF (invis√≠vel) -->
    <div id="pdfContent"></div>

    <script>
        // M√°scaras de input
        document.getElementById('cpf').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            e.target.value = value;
        });

        document.getElementById('telefone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{2})(\d)/, '($1) $2');
            value = value.replace(/(\d{5})(\d)/, '$1-$2');
            e.target.value = value;
        });

        document.getElementById('cep').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{5})(\d)/, '$1-$2');
            e.target.value = value;
        });

        // Definir data atual
        document.getElementById('dataDeclaracao').valueAsDate = new Date();

        // Fun√ß√µes auxiliares
        function formatarData(data) {
            const [ano, mes, dia] = data.split('-');
            return `${dia}/${mes}/${ano}`;
        }

        function formatarDataExtenso(data) {
            const meses = [
                'janeiro', 'fevereiro', 'mar√ßo', 'abril', 'maio', 'junho',
                'julho', 'agosto', 'setembro', 'outubro', 'novembro', 'dezembro'
            ];
            const [ano, mes, dia] = data.split('-');
            return `${dia} de ${meses[parseInt(mes) - 1]} de ${ano}`;
        }

        function calcularValorMensal(nivel, valorUPF) {
            const multiplicadores = { '1': 1, '2': 1.5, '3': 2 };
            const upfNum = parseFloat(valorUPF.replace(',', '.'));
            return (upfNum * multiplicadores[nivel]).toFixed(2).replace('.', ',');
        }

        // Submiss√£o do formul√°rio
        document.getElementById('declaracaoForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const dados = {
                nome: document.getElementById('nome').value,
                cpf: document.getElementById('cpf').value,
                rg: document.getElementById('rg').value,
                dataNascimento: formatarData(document.getElementById('dataNascimento').value),
                telefone: document.getElementById('telefone').value,
                email: document.getElementById('email').value,
                endereco: document.getElementById('endereco').value,
                bairro: document.getElementById('bairro').value,
                cep: document.getElementById('cep').value,
                profissao: document.getElementById('profissao').value,
                localPrestacao: document.getElementById('localPrestacao').value,
                nivel: document.getElementById('nivel').value,
                valorUPF: document.getElementById('valorUPF').value,
                dataDeclaracao: document.getElementById('dataDeclaracao').value
            };

            const nivelInfo = {
                '1': { valor: '1 UPF' },
                '2': { valor: '1,5 UPF' },
                '3': { valor: '2 UPF' }
            };

            const valorMensal = calcularValorMensal(dados.nivel, dados.valorUPF);

            // Mostrar overlay de loading
            document.getElementById('loadingOverlay').classList.add('show');
            document.getElementById('declaracaoForm').querySelector('.btn-submit').disabled = true;

            // Criar HTML do PDF - Dividido em 2 p√°ginas
            const pdfHTML = `
                <div class="pdf-document" id="pdfElement">
                    <!-- P√ÅGINA 1 -->
                    <div class="pdf-page">
                        <div class="pdf-header">
                            <h1>DECLARA√á√ÉO DE EXERC√çCIO DE ATIVIDADE AUT√îNOMA</h1>
                            <h2>Para fins de lan√ßamento do ISSQN</h2>
                            <p>Prefeitura Municipal de Porto Velho - Secretaria Municipal de Economia (SEMEC)</p>
                        </div>

                        <div class="field-line"><strong>Nome Completo:</strong> ${dados.nome}</div>
                        <div class="field-line"><strong>CPF:</strong> ${dados.cpf} &nbsp;&nbsp; <strong>RG:</strong> ${dados.rg}</div>
                        <div class="field-line"><strong>Data de Nascimento:</strong> ${dados.dataNascimento} &nbsp;&nbsp; <strong>Telefone:</strong> ${dados.telefone}</div>
                        <div class="field-line"><strong>E-mail:</strong> ${dados.email}</div>
                        <div class="field-line"><strong>Endere√ßo:</strong> ${dados.endereco}</div>
                        <div class="field-line"><strong>CEP:</strong> ${dados.cep} &nbsp;&nbsp; <strong>Bairro:</strong> ${dados.bairro} &nbsp;&nbsp; <strong>Cidade/UF:</strong> Porto Velho/RO</div>
                        <div class="field-line"><strong>Profiss√£o:</strong> ${dados.profissao}</div>
                        <div class="field-line"><strong>Local de Presta√ß√£o:</strong> ${dados.localPrestacao}</div>

                        <h3>I - DECLARA√á√ÉO DE EXERC√çCIO DE ATIVIDADE AUT√îNOMA</h3>
                        <p>Declaro, para os devidos fins de direito e sob as penas da lei, que exer√ßo atividade profissional aut√¥noma, de forma habitual e permanente, prestando servi√ßos de natureza <strong>${dados.profissao}</strong> no Munic√≠pio de Porto Velho/RO.</p>

                        <h3>II - ENQUADRAMENTO NA TABELA DE APURA√á√ÉO DO ISSQN</h3>
                        <p>Declaro que me enquadro na seguinte categoria:</p>
                        
                        <div class="checkbox-line"><strong>[${dados.nivel === '1' ? 'X' : ' '}]</strong> Item 1 - Fundamental ou nenhuma escolaridade - Imposto: 1 UPF</div>
                        <div class="checkbox-line"><strong>[${dados.nivel === '2' ? 'X' : ' '}]</strong> Item 2 - N√≠vel m√©dio - Imposto: 1,5 UPF</div>
                        <div class="checkbox-line"><strong>[${dados.nivel === '3' ? 'X' : ' '}]</strong> Item 3 - N√≠vel superior - Imposto: 2 UPF</div>

                        <p><strong>Valor mensal devido:</strong> ${nivelInfo[dados.nivel].valor}, correspondente a R$ ${valorMensal}</p>

                        <h3>III - RECONHECIMENTO DA OBRIGA√á√ÉO TRIBUT√ÅRIA</h3>
                        <p><strong>1.</strong> RECONHE√áO que sou contribuinte aut√¥nomo, sujeito √†s regras dessa natureza, do ISSQN no Munic√≠pio de Porto Velho/RO.</p>
                        <p><strong>2.</strong> DECLARO ter plena ci√™ncia de que o ISSQN ser√° lan√ßado anualmente com parcelas mensais.</p>
                        <p><strong>3.</strong> CONCORDO com o lan√ßamento anual do ISSQN pela Administra√ß√£o Tribut√°ria.</p>

                        <h3>IV - CONFISS√ÉO DE D√çVIDA</h3>
                        <p><strong>4.</strong> Esta declara√ß√£o constitui CONFISS√ÉO DE D√çVIDA l√≠quida, certa e exig√≠vel.</p>
                    </div>

                    <!-- P√ÅGINA 2 -->
                    <div class="page-break"></div>
                    <div class="pdf-page">
                        <p><strong>5.</strong> RECONHE√áO que o n√£o pagamento acarretar√° multa, juros e inscri√ß√£o em D√≠vida Ativa.</p>

                        <h3>V - RESPONSABILIDADE</h3>
                        <p><strong>6.</strong> DECLARO, sob as penas da lei, que todas as informa√ß√µes s√£o verdadeiras.</p>

                        <h3>ANEXO - TABELA B</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Profissionais aut√¥nomos por n√≠vel</th>
                                    <th>Al√≠quota</th>
                                    <th>Imposto</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td>N√≠vel fundamental ou nenhuma escolaridade</td>
                                    <td>1 UPF</td>
                                    <td>1 UPF</td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td>N√≠vel m√©dio</td>
                                    <td>1,5 UPF</td>
                                    <td>1,5 UPF</td>
                                </tr>
                                <tr>
                                    <td>3</td>
                                    <td>N√≠vel superior</td>
                                    <td>2 UPF</td>
                                    <td>2 UPF</td>
                                </tr>
                            </tbody>
                        </table>

                        <hr>
                        <p style="text-align: center; margin-top: 20px;">Porto Velho/RO, ${formatarDataExtenso(dados.dataDeclaracao)}</p>

                        <div class="signature-area">
                            <div class="signature-line"></div>
                            <strong>${dados.nome}</strong><br>
                            CPF: ${dados.cpf}
                        </div>

                        <hr style="margin-top: 30px;">
                        <p style="font-size: 9pt;"><strong>BASE LEGAL:</strong> Lei Complementar Municipal n¬∫ 878/2021</p>
                    </div>
                </div>
            `;

            // Inserir no DOM temporariamente
            const container = document.getElementById('pdfContent');
            container.innerHTML = pdfHTML;

            // Aguardar renderiza√ß√£o
            await new Promise(resolve => setTimeout(resolve, 800));

            const element = document.getElementById('pdfElement');

            try {
                // Criar PDF usando jsPDF diretamente com m√∫ltiplas p√°ginas
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');

                // Capturar cada p√°gina separadamente
                const pages = element.querySelectorAll('.pdf-page');
                
                for (let i = 0; i < pages.length; i++) {
                    if (i > 0) {
                        pdf.addPage();
                    }

                    const canvas = await html2canvas(pages[i], {
                        scale: 2,
                        useCORS: true,
                        logging: false,
                        backgroundColor: '#ffffff',
                        width: pages[i].scrollWidth,
                        height: pages[i].scrollHeight
                    });

                    const imgData = canvas.toDataURL('image/jpeg', 0.95);
                    const imgWidth = 210; // A4 width
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    
                    pdf.addImage(imgData, 'JPEG', 0, 0, imgWidth, imgHeight);
                }

                // Salvar PDF
                pdf.save(`Declaracao_ISSQN_${dados.cpf.replace(/\D/g, '')}.pdf`);

                // Limpar
                container.innerHTML = '';
                document.getElementById('loadingOverlay').classList.remove('show');
                document.getElementById('declaracaoForm').querySelector('.btn-submit').disabled = false;

                alert('‚úÖ PDF gerado com sucesso!');

            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                container.innerHTML = '';
                document.getElementById('loadingOverlay').classList.remove('show');
                document.getElementById('declaracaoForm').querySelector('.btn-submit').disabled = false;
                alert('‚ùå Erro ao gerar PDF: ' + error.message);
            }
        });
    </script>
</body>
</html>
